apiVersion: batch/v1
kind: CronJob
metadata:
  name: copilot-usage-ingestor
spec:
  # 02:00 UTC daily
  schedule: "0 2 * * *"
  successfulJobsHistoryLimit: 1
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: worker
              image: ghcr.io/port-experimental/copilot-usage-ingestor:latest
              envFrom:
                - secretRef: { name: ai-usage-secrets }
              resources:
                requests: { cpu: "100m", memory: "128Mi" }
                limits:   { cpu: "500m", memory: "512Mi" }
